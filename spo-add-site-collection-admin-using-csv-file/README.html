<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <title>Add a Site Collection Admin using a csv file | PnP Samples </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Add a Site Collection Admin using a csv file | PnP Samples ">
    <meta name="generator" content="docfx 2.56.7.0">
    <meta name="description" content="A sample gallery of scripts to manage all things Microsoft 365.">
  
    <!-- Social Media -->
    <meta property="og:locale" content="en_GB">
    <meta property="og:title" content="Add a Site Collection Admin using a csv file | PnP Samples ">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pnp.github.io/script-samples">
    <meta property="og:image" content="https://pnp.github.io/script-samples/assets/social-media-screenshot.png">
    <meta property="og:image:alt" content="Screenshot example of the PnP Script Samples Site">
    <meta property="og:site_name" content="PnP Script Samples">
    <meta property="og:description" content="A sample gallery of scripts to manage all things Microsoft 365.">
  
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/extra.css">
    <link rel="stylesheet" href="../styles/filter.css">
    <link rel="stylesheet" href="../styles/site.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    <meta property="docfx:newtab" content="true">
    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "8j6pedl344");
  </script>
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
             <div class="github-mark">
              <a href="https://github.com/pnp/script-samples">
                <img src="https://pnp.github.io/script-samples/assets/icons/github-light-64px.png" alt="GitHub Icon Image">
              </a>
            </div>
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../assets/logo.svg" alt="">
              </a>    </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-12">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/siddharth-vaghasia/script-samples/blob/main/scripts/spo-add-site-collection-admin-using-csv-file/README.md/#L1" title="Improve this Doc" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
                    <h1 id="add-a-site-collection-admin-using-a-csv-file">Add a Site Collection Admin using a csv file</h1>

<h2 id="summary">Summary</h2>
<div class="WARNING">
<h5>Warning</h5>
<p>When you decide to add users for all your Site Collections, you can't simply run through all the sites in your tenant. Why? Because what you &quot;see&quot; in the SPO admin center, is not reflecting what you have. There a few Site Collections that are not visible. A few examples would be:</p>
<ul>
<li>Search</li>
<li>My Site (contoso-my.sharepoint.com)</li>
<li>Sites created with Private Channels</li>
</ul>
<p>Sites created with Private Channels are not (yet?) visible in the SharePoint Online admin center, so adding users as Site Collection Admins into those could cause chaos! It's safer to get a list of all your sites, and keep the intended ones in your csv file to feed the script.</p>
</div>
<h2 id="get-all-the-site-collections-in-your-tenant">Get all the Site Collections in your tenant</h2>
<p>To get all the Site Collections in your tenant and export to a .csv file, you can run the following:</p>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_cli-m365-ps1" role="tab" aria-controls="tabpanel_CeZOj-G++Q_cli-m365-ps1" data-tab="cli-m365-ps1" tabindex="0" aria-selected="true">CLI for Microsoft 365</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q_cli-m365-ps1" role="tabpanel" data-tab="cli-m365-ps1"><button class="article-clipboard" title="Copy to clipboard" data-toggle="tooltip" data-placement="top" data-clipboard-target="section[id^='tabpanel'][data-tab='cli-m365-ps1'] pre">
    <span class="glyphicon glyphicon-copy" aria-hidden="true"></span>
    <span class="article-clipboard__message done">Copied</span>
</button>

<pre><code class="lang-powershell">$allSites = m365 spo site classic list --query &quot;[?Template!='SRCHCEN#0']&quot; -o json | ConvertFrom-Json
$results = @()

foreach($site in $allSites){
    $results += [pscustomobject][ordered]@{
        Title = $site.Title
        Url = $site.Url
        Template = $site.Template
    }
}
$results | Export-Csv -Path &quot;&lt;YOUR-CSV-FILE-PATH&gt;&quot;
</code></pre>
</section>
</div>

<p>The script above has a query to ignore the site collection by filtering with the template code. If for example you wish to only get the sites that have been created with Private Channels, you could amend your query as follows:</p>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_cli-m365-ps2" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_cli-m365-ps2" data-tab="cli-m365-ps2" tabindex="0" aria-selected="true">CLI for Microsoft 365</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-1_cli-m365-ps2" role="tabpanel" data-tab="cli-m365-ps2"><button class="article-clipboard" title="Copy to clipboard" data-toggle="tooltip" data-placement="top" data-clipboard-target="section[id^='tabpanel'][data-tab='cli-m365-ps2'] pre">
    <span class="glyphicon glyphicon-copy" aria-hidden="true"></span>
    <span class="article-clipboard__message done">Copied</span>
</button>

<pre><code class="lang-powershell">$privateChannelSites = m365 spo site classic list --query &quot;[?Template=='TEAMCHANNEL#0']&quot; -o json | ConvertFrom-Json
</code></pre>
</section>
</div>
<h2 id="add-the-user-as-site-collection-admin">Add the user as Site Collection Admin</h2>
<p>Once you've got the .csv file from the script above, filter it to your needs to keep only the targeted sites, and use it in the script below.</p>
<div class="NOTE">
<h5>Note</h5>
<p>The script will add the user as a &quot;site admin&quot; on classic and non group-connected sites, or a an &quot;additional admin&quot; in group-connected sites (and not as a group Member).</p>
</div>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-2">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-2_cli-m365-ps" role="tab" aria-controls="tabpanel_CeZOj-G++Q-2_cli-m365-ps" data-tab="cli-m365-ps" tabindex="0" aria-selected="true">CLI for Microsoft 365 using PowerShell</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-2_cli-m365-ps" role="tabpanel" data-tab="cli-m365-ps"><button class="article-clipboard" title="Copy to clipboard" data-toggle="tooltip" data-placement="top" data-clipboard-target="section[id^='tabpanel'][data-tab='cli-m365-ps'] pre">
    <span class="glyphicon glyphicon-copy" aria-hidden="true"></span>
    <span class="article-clipboard__message done">Copied</span>
</button>

<pre><code class="lang-powershell">$csvSites = Import-Csv -Path &quot;&lt;YOUR-CSV-FILE-PATH&gt;&quot;
$UserToAdd = &quot;john.smith@contoso.com&quot;  ## Change to your user
$siteCount = $csvSites.Count

Write-Host &quot;Processing $siteCount sites...&quot; -f Cyan

#Loop through the sites in the csv file
foreach($site in $csvSites){
    Write-Host &quot;Going through $($site.Title)&quot; 
    
    $users = m365 spo user list --webUrl $site.Url -o json | ConvertFrom-Json
    $admins = $users.value | Where-Object {$_.IsSiteAdmin -eq $true}
        
        if ($admins.Email -eq $UserToAdd) {
            Write-Host &quot;User $($UserToAdd) is already an Admin in $($site.Title).&quot; -f Green
        }
        else{
            Write-Host &quot;Adding $($UserToAdd) to $($site.Title). &quot; -f Magenta
            m365 spo site classic set --url $site.Url --owners $UserToAdd
        }
}
</code></pre>
<div class="highlight-tool">
<p>Check out the <strong>CLI for Microsoft 365</strong> to learn more at: <a href="https://aka.ms/cli-m365">https://aka.ms/cli-m365</a></p>
</div>
</section>
</div>
<h2 id="source-credit">Source Credit</h2>
<p>Sample first appeared on <a href="https://pnp.github.io/cli-microsoft365/sample-scripts/spo/add-site-collection-admin-using-csv-file/">Add a Site Collection Admin using a csv file | CLI for Microsoft 365</a></p>
<h2 id="contributors">Contributors</h2>
<table>
<thead>
<tr>
<th>Author(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Veronique Lengelle</td>
</tr>
</tbody>
</table>
<h2 id="disclaimer">Disclaimer</h2>
<p><strong>THESE SAMPLES ARE PROVIDED <em>AS IS</em> WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING ANY IMPLIED WARRANTIES OF FITNESS FOR A PARTICULAR PURPOSE, MERCHANTABILITY, OR NON-INFRINGEMENT.</strong></p>
<img src="https://telemetry.sharepointpnp.com/script-samples/scripts/spo-add-site-collection-admin-using-csv-file" aria-hidden="true">
</article>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Script Samples<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
            
            <!-- <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer"> -->
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
    
    <script type="text/javascript" src="../styles/clipboard.min.js"></script>
    <script type="text/javascript" src="../styles/isotope.pkgd.min.js"></script>
    <script type="text/javascript" src="../styles/loadsamples.js"></script>
    <script type="text/javascript" src="../styles/filtersamples.js"></script>

  </body>
</html>